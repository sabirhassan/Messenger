{"ast":null,"code":"var _jsxFileName = \"/home/sabirhassan/Desktop/imroz2/client/src/components/NewChat/newChat.js\";\nimport React from 'react';\nimport { FormControl, InputLabel, Input, Button, Paper, withStyles, CssBaseline, Typography } from '@material-ui/core';\nimport styles from './styles';\n\nconst firebase = require(\"firebase\");\n\nclass NewChatComponent extends React.Component {\n  constructor() {\n    super();\n\n    this.userTyping = (inputType, e) => {\n      switch (inputType) {\n        case 'username':\n          this.setState({\n            username: e.target.value\n          });\n          break;\n\n        case 'message':\n          this.setState({\n            message: e.target.value\n          });\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    this.submitNewChat = async e => {\n      e.preventDefault();\n      const userExists = await this.userExists();\n\n      if (userExists) {\n        const chatExists = await this.chatExists();\n        chatExists ? this.goToChat() : this.createChat();\n      }\n    };\n\n    this.buildDocKey = () => [firebase.auth().currentUser.email, this.state.username].sort().join(':');\n\n    this.createChat = () => {\n      this.props.newChatSubmitFn({\n        sendTo: this.state.username,\n        message: this.state.message\n      });\n    };\n\n    this.goToChat = () => this.props.goToChatFn(this.buildDocKey(), this.state.message);\n\n    this.chatExists = async () => {\n      const docKey = this.buildDocKey();\n      const chat = await firebase.firestore().collection('chats').doc(docKey).get();\n      console.log(chat.exists);\n      return chat.exists;\n    };\n\n    this.userExists = async () => {\n      const usersSnapshot = await firebase.firestore().collection('users').get();\n      const exists = usersSnapshot.docs.map(_doc => _doc.data().email).includes(this.state.username);\n      this.setState({\n        serverError: !exists\n      });\n      return exists;\n    };\n\n    this.state = {\n      username: null,\n      message: null\n    };\n  }\n\n  render() {\n    const {\n      classes\n    } = this.props;\n    return /*#__PURE__*/React.createElement(\"main\", {\n      className: classes.main,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 21,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(CssBaseline, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 22,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Paper, {\n      className: classes.paper,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 23,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Typography, {\n      component: \"h1\",\n      variant: \"h5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 24,\n        columnNumber: 11\n      }\n    }, \"Send A Message!\"), /*#__PURE__*/React.createElement(\"form\", {\n      className: classes.form,\n      onSubmit: e => this.submitNewChat(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 25,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      fullWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 26,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(InputLabel, {\n      htmlFor: \"new-chat-username\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 27,\n        columnNumber: 15\n      }\n    }, \"Enter Your Friend's Email\"), /*#__PURE__*/React.createElement(Input, {\n      required: true,\n      className: classes.input,\n      autoFocus: true,\n      onChange: e => this.userTyping('username', e),\n      id: \"new-chat-username\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 30,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(FormControl, {\n      fullWidth: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(InputLabel, {\n      htmlFor: \"new-chat-message\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 15\n      }\n    }, \"Enter Your Message\"), /*#__PURE__*/React.createElement(Input, {\n      required: true,\n      className: classes.input,\n      onChange: e => this.userTyping('message', e),\n      id: \"new-chat-message\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      fullWidth: true,\n      variant: \"contained\",\n      color: \"primary\",\n      className: classes.submit,\n      type: \"submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 13\n      }\n    }, \"Send\")), this.state.serverError ? /*#__PURE__*/React.createElement(Typography, {\n      component: \"h5\",\n      variant: \"h6\",\n      className: classes.errorText,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 13\n      }\n    }, \"Unable to locate the user\") : null));\n  }\n\n  componentWillMount() {\n    if (!firebase.auth().currentUser) this.props.history.push('/login');\n  }\n\n}\n\nexport default withStyles(styles)(NewChatComponent);","map":{"version":3,"sources":["/home/sabirhassan/Desktop/imroz2/client/src/components/NewChat/newChat.js"],"names":["React","FormControl","InputLabel","Input","Button","Paper","withStyles","CssBaseline","Typography","styles","firebase","require","NewChatComponent","Component","constructor","userTyping","inputType","e","setState","username","target","value","message","submitNewChat","preventDefault","userExists","chatExists","goToChat","createChat","buildDocKey","auth","currentUser","email","state","sort","join","props","newChatSubmitFn","sendTo","goToChatFn","docKey","chat","firestore","collection","doc","get","console","log","exists","usersSnapshot","docs","map","_doc","data","includes","serverError","render","classes","main","paper","form","input","submit","errorText","componentWillMount","history","push"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { FormControl, InputLabel, Input, Button, Paper, withStyles, CssBaseline, Typography } from '@material-ui/core';\nimport styles from './styles';\nconst firebase = require(\"firebase\");\n\nclass NewChatComponent extends React.Component {\n\n  constructor() {\n    super();\n    this.state = {\n      username: null,\n      message: null\n    };\n  }\n\n  render() {\n\n    const { classes } = this.props;\n\n    return(\n      <main className={classes.main}>\n        <CssBaseline/>\n        <Paper className={classes.paper}>\n          <Typography component=\"h1\" variant=\"h5\">Send A Message!</Typography>\n          <form className={classes.form} onSubmit={(e) => this.submitNewChat(e)}>\n            <FormControl fullWidth>\n              <InputLabel htmlFor='new-chat-username'>\n                  Enter Your Friend's Email\n              </InputLabel>\n              <Input required \n                className={classes.input}\n                autoFocus \n                onChange={(e) => this.userTyping('username', e)} \n                id='new-chat-username'>\n              </Input>\n            </FormControl>\n            <FormControl fullWidth>\n              <InputLabel htmlFor='new-chat-message'>\n                  Enter Your Message\n              </InputLabel>\n              <Input required \n                className={classes.input}\n                onChange={(e) => this.userTyping('message', e)} \n                id='new-chat-message'>\n              </Input>\n            </FormControl>\n            <Button fullWidth variant='contained' color='primary' className={classes.submit} type='submit'>Send</Button>\n          </form>\n          {\n            this.state.serverError ? \n            <Typography component='h5' variant='h6' className={classes.errorText}>\n              Unable to locate the user\n            </Typography> :\n            null\n          }\n        </Paper>\n      </main>\n    );\n  }\n\n  componentWillMount() {\n    if(!firebase.auth().currentUser)\n      this.props.history.push('/login');\n  }\n\n  userTyping = (inputType, e) => {\n    switch (inputType) {\n      case 'username':\n        this.setState({ username: e.target.value });\n        break;\n      \n      case 'message':\n        this.setState({ message: e.target.value });\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  submitNewChat = async (e) => {\n    e.preventDefault();\n    const userExists = await this.userExists();\n    if(userExists) {\n      const chatExists = await this.chatExists();\n      chatExists ? this.goToChat() : this.createChat();\n    }\n  }\n\n  buildDocKey = () => [firebase.auth().currentUser.email, this.state.username].sort().join(':');\n\n  createChat = () => {\n    this.props.newChatSubmitFn({\n      sendTo: this.state.username,\n      message: this.state.message\n    });\n  }\n\n  goToChat = () => this.props.goToChatFn(this.buildDocKey(), this.state.message);\n\n  chatExists = async () => {\n    const docKey = this.buildDocKey();\n    const chat = await \n      firebase\n      .firestore()\n      .collection('chats')\n      .doc(docKey)\n      .get();\n    console.log(chat.exists);\n    return chat.exists;\n  }\n  userExists = async () => {\n    const usersSnapshot = await \n    firebase\n      .firestore()\n      .collection('users')\n      .get();\n    const exists = usersSnapshot\n      .docs\n        .map(_doc => _doc.data().email)\n        .includes(this.state.username);\n    this.setState({ serverError: !exists });\n    return exists;\n  }\n}\n\nexport default withStyles(styles)(NewChatComponent);"]},"metadata":{},"sourceType":"module"}